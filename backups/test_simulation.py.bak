#!/usr/bin/env python3
"""
Test Script - Verificaci√≥n r√°pida del proyecto PCR Termophilic Cells
"""

import sys
import os

def test_imports():
    """Prueba las importaciones principales"""
    print("üîç Probando importaciones...")
    
    try:
        import pygame
        print("   ‚úÖ pygame")
    except ImportError as e:
        print(f"   ‚ùå pygame: {e}")
        return False
    
    try:
        import numpy as np
        print("   ‚úÖ numpy")
    except ImportError as e:
        print(f"   ‚ùå numpy: {e}")
        return False
    
    try:
        from OpenGL.GL import glClear, GL_COLOR_BUFFER_BIT
        print("   ‚úÖ OpenGL")
    except ImportError as e:
        print(f"   ‚ùå OpenGL: {e}")
        return False
    
    try:
        from plyfile import PlyData
        print("   ‚úÖ plyfile")
    except ImportError as e:
        print(f"   ‚ùå plyfile: {e}")
        return False
    
    return True

def test_pygame_init():
    """Prueba la inicializaci√≥n de pygame"""
    print("\nüéÆ Probando pygame...")
    
    try:
        import pygame
        pygame.init()
        screen = pygame.display.set_mode((100, 100))
        pygame.quit()
        print("   ‚úÖ pygame funciona correctamente")
        return True
    except Exception as e:
        print(f"   ‚ùå Error con pygame: {e}")
        return False

def test_opengl():
    """Prueba OpenGL"""
    print("\nüé® Probando OpenGL...")
    
    try:
        import pygame
        from OpenGL.GL import glClear, GL_COLOR_BUFFER_BIT
        from OpenGL.GLU import gluPerspective
        
        pygame.init()
        screen = pygame.display.set_mode((100, 100), pygame.OPENGL)
        glClear(GL_COLOR_BUFFER_BIT)
        pygame.quit()
        print("   ‚úÖ OpenGL funciona correctamente")
        return True
    except Exception as e:
        print(f"   ‚ùå Error con OpenGL: {e}")
        return False

def test_ply_model():
    """Prueba la carga del modelo PLY"""
    print("\nüì¶ Probando modelo PLY...")
    
    try:
        from plyfile import PlyData
        
        model_path = "models/thermophilic_cell.ply"
        if os.path.exists(model_path):
            plydata = PlyData.read(model_path)
            vertex_count = len(plydata['vertex'])
            print(f"   ‚úÖ Modelo PLY cargado: {vertex_count} v√©rtices")
            return True
        else:
            print("   ‚ö†Ô∏è  Modelo PLY no encontrado")
            return False
    except Exception as e:
        print(f"   ‚ùå Error cargando PLY: {e}")
        return False

def test_simulation_class():
    """Prueba la clase de simulaci√≥n"""
    print("\nüß¨ Probando clase de simulaci√≥n...")
    
    try:
        from pcr_simple_simulation import SimplePCRSimulation
        
        # Crear instancia sin inicializar pygame
        simulation = SimplePCRSimulation.__new__(SimplePCRSimulation)
        simulation.width = 800
        simulation.height = 600
        simulation.cells = []
        simulation.current_stage = "cooling"
        
        print("   ‚úÖ Clase de simulaci√≥n funciona")
        return True
    except Exception as e:
        print(f"   ‚ùå Error con clase de simulaci√≥n: {e}")
        return False

def main():
    """Funci√≥n principal de pruebas"""
    print("üß¨ PCR Termophilic Cells - Test de Verificaci√≥n")
    print("="*50)
    
    tests = [
        test_imports,
        test_pygame_init,
        test_opengl,
        test_ply_model,
        test_simulation_class
    ]
    
    passed = 0
    total = len(tests)
    
    for test in tests:
        if test():
            passed += 1
    
    print("\n" + "="*50)
    print(f"üìä Resultados: {passed}/{total} pruebas pasaron")
    
    if passed == total:
        print("‚úÖ ¬°Todas las pruebas pasaron! El proyecto est√° listo para usar.")
        print("\nüöÄ Para ejecutar la simulaci√≥n:")
        print("   python pcr_simple_simulation.py")
    else:
        print("‚ùå Algunas pruebas fallaron. Revisa los errores anteriores.")
        print("\nüîß Para instalar dependencias faltantes:")
        print("   pip install pygame numpy pyopengl plyfile scipy matplotlib pillow")
    
    return passed == total

if __name__ == "__main__":
    success = main()
    sys.exit(0 if success else 1) 