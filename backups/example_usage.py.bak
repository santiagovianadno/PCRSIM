#!/usr/bin/env python3
"""
Ejemplo de uso para PCR Termophilic Cells Interactive Videomapping
Demuestra diferentes configuraciones y caracterÃ­sticas del proyecto
"""

import sys
import os
import time

def print_banner():
    """Imprime el banner del proyecto"""
    print("="*70)
    print("ğŸ§¬ PCR Termophilic Cells Interactive Videomapping")
    print("   Ejemplo de uso y configuraciÃ³n")
    print("="*70)

def check_requirements():
    """Verifica que los requisitos estÃ©n instalados"""
    print("ğŸ” Verificando requisitos...")
    
    required_modules = [
        "pygame", "cv2", "mediapipe", "numpy", 
        "OpenGL", "plyfile", "scipy", "matplotlib"
    ]
    
    missing_modules = []
    
    for module in required_modules:
        try:
            if module == "cv2":
                import cv2
            elif module == "OpenGL":
                from OpenGL.GL import glClear
            else:
                __import__(module)
            print(f"   âœ… {module}")
        except ImportError:
            print(f"   âŒ {module} - No encontrado")
            missing_modules.append(module)
    
    if missing_modules:
        print(f"\nâŒ Faltan mÃ³dulos: {', '.join(missing_modules)}")
        print("   Ejecuta: python setup.py")
        return False
    
    print("âœ… Todos los requisitos estÃ¡n instalados")
    return True

def run_basic_simulation():
    """Ejecuta la simulaciÃ³n bÃ¡sica"""
    print("\nğŸ® Ejecutando simulaciÃ³n bÃ¡sica...")
    print("   Presiona ESC para salir")
    
    try:
        from pcr_thermophilic_simulation import PCRSimulation
        simulation = PCRSimulation()
        simulation.run()
    except Exception as e:
        print(f"   âŒ Error: {e}")

def run_advanced_simulation():
    """Ejecuta la simulaciÃ³n avanzada"""
    print("\nğŸš€ Ejecutando simulaciÃ³n avanzada...")
    print("   Presiona ESC para salir")
    
    try:
        from pcr_advanced_simulation import AdvancedPCRSimulation
        simulation = AdvancedPCRSimulation()
        simulation.run()
    except Exception as e:
        print(f"   âŒ Error: {e}")

def demonstrate_ply_loading():
    """Demuestra la carga de modelos PLY"""
    print("\nğŸ“¦ Demostrando carga de modelos PLY...")
    
    try:
        from ply_cell_renderer import PLYCellModel
        
        # Intentar cargar el modelo de ejemplo
        model_path = "models/thermophilic_cell.ply"
        if os.path.exists(model_path):
            model = PLYCellModel(model_path)
            print(f"   âœ… Modelo cargado: {len(model.vertices)} vÃ©rtices")
            print(f"   âœ… Caras: {len(model.indices)}")
        else:
            print(f"   âš ï¸  Modelo no encontrado: {model_path}")
            print("   Creando modelo por defecto...")
            model = PLYCellModel("nonexistent.ply")  # Esto crearÃ¡ geometrÃ­a por defecto
            print(f"   âœ… Modelo por defecto creado: {len(model.vertices)} vÃ©rtices")
    
    except Exception as e:
        print(f"   âŒ Error: {e}")

def demonstrate_cell_factory():
    """Demuestra la fÃ¡brica de cÃ©lulas"""
    print("\nğŸ­ Demostrando fÃ¡brica de cÃ©lulas...")
    
    try:
        from ply_cell_renderer import CellFactory
        import numpy as np
        
        # Crear diferentes tipos de cÃ©lulas
        position = np.array([0.0, 0.0, 0.0])
        
        cell_types = [
            ("Thermus aquaticus", CellFactory.create_thermus_aquaticus),
            ("Pyrococcus furiosus", CellFactory.create_pyrococcus_furiosus),
            ("Thermococcus litoralis", CellFactory.create_thermococcus_litoralis)
        ]
        
        for name, factory_func in cell_types:
            cell_data = factory_func(position)
            print(f"   âœ… {name}:")
            print(f"      Temperatura Ã³ptima: {cell_data['optimal_temp']}Â°C")
            print(f"      Temperatura mÃ¡xima: {cell_data['max_temp']}Â°C")
            print(f"      Color: {cell_data['color']}")
            print(f"      TamaÃ±o: {cell_data['size']}")
    
    except Exception as e:
        print(f"   âŒ Error: {e}")

def show_interaction_guide():
    """Muestra la guÃ­a de interacciÃ³n"""
    print("\nğŸ‘ GuÃ­a de InteracciÃ³n:")
    print("   ğŸ“± Mueve tus manos frente a la cÃ¡mara")
    print("   ğŸ¯ Las cÃ©lulas reaccionarÃ¡n a tu presencia")
    print("   ğŸ”¥ Toca las cÃ©lulas para activarlas")
    print("   ğŸŒ¡ï¸  Observa cÃ³mo cambian de color con la temperatura")
    print("   âš¡ Las cÃ©lulas liberan partÃ­culas de energÃ­a")
    print("   ğŸ”„ El proceso de PCR avanza automÃ¡ticamente")

def show_controls():
    """Muestra los controles disponibles"""
    print("\nğŸ® Controles del Teclado:")
    print("   ESPACIO - Avanzar manualmente a la siguiente etapa")
    print("   R       - Reiniciar la simulaciÃ³n")
    print("   P       - Pausar/Reanudar")
    print("   C       - Mostrar/Ocultar vista de cÃ¡mara")
    print("   A       - Activar/Desactivar auto-avance")
    print("   D       - Mostrar/Ocultar visualizaciÃ³n de DNA")
    print("   T       - Mostrar/Ocultar partÃ­culas")
    print("   ESC     - Salir")

def show_pcr_stages():
    """Muestra informaciÃ³n sobre las etapas del PCR"""
    print("\nğŸ§¬ Etapas del PCR Simuladas:")
    print("   1. ğŸ”¥ DesnaturalizaciÃ³n (94Â°C)")
    print("      - SeparaciÃ³n de cadenas de DNA")
    print("      - CÃ©lulas cambian a rojo intenso")
    print("      - Efectos de calor extremo")
    print()
    print("   2. ğŸ”— Annealing (50-65Â°C)")
    print("      - UniÃ³n de primers al DNA")
    print("      - CÃ©lulas en color naranja")
    print("      - VisualizaciÃ³n de primers")
    print()
    print("   3. ğŸ§¬ ExtensiÃ³n (72Â°C)")
    print("      - SÃ­ntesis de nueva cadena de DNA")
    print("      - CÃ©lulas en color amarillo")
    print("      - Efectos de sÃ­ntesis")
    print()
    print("   4. â„ï¸  Enfriamiento (25Â°C)")
    print("      - PreparaciÃ³n para el siguiente ciclo")
    print("      - CÃ©lulas regresan a color verde")
    print("      - RecuperaciÃ³n de energÃ­a")

def main():
    """FunciÃ³n principal"""
    print_banner()
    
    # Verificar requisitos
    if not check_requirements():
        return
    
    # Mostrar informaciÃ³n
    show_pcr_stages()
    show_interaction_guide()
    show_controls()
    
    # Demostraciones
    demonstrate_ply_loading()
    demonstrate_cell_factory()
    
    # MenÃº de opciones
    while True:
        print("\n" + "="*50)
        print("ğŸ¯ Â¿QuÃ© quieres hacer?")
        print("   1. Ejecutar simulaciÃ³n bÃ¡sica")
        print("   2. Ejecutar simulaciÃ³n avanzada")
        print("   3. Ver informaciÃ³n del proyecto")
        print("   4. Salir")
        
        try:
            choice = input("\n   Selecciona una opciÃ³n (1-4): ").strip()
            
            if choice == "1":
                run_basic_simulation()
            elif choice == "2":
                run_advanced_simulation()
            elif choice == "3":
                print("\nğŸ“š InformaciÃ³n del Proyecto:")
                print("   ğŸ§¬ Simula el proceso de PCR usando cÃ©lulas termÃ³filas")
                print("   ğŸ® Interactividad con detecciÃ³n de manos (MediaPipe)")
                print("   ğŸ¨ VisualizaciÃ³n 3D con OpenGL y modelos PLY")
                print("   ğŸ”¬ CÃ©lulas termÃ³filas reales: Thermus aquaticus, etc.")
                print("   ğŸ“– Educativo: Historia del PCR y biologÃ­a molecular")
                print("   ğŸ­ ArtÃ­stico: Videomapping interactivo")
            elif choice == "4":
                print("\nğŸ‘‹ Â¡Gracias por usar PCR Termophilic Cells!")
                break
            else:
                print("   âŒ OpciÃ³n no vÃ¡lida")
        
        except KeyboardInterrupt:
            print("\n\nğŸ‘‹ Â¡Hasta luego!")
            break
        except Exception as e:
            print(f"   âŒ Error: {e}")

if __name__ == "__main__":
    main() 